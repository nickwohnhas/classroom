<h2>Student Page</h2>

<h3> Welcome, <%= @user.name %>! </h3><br>

<h4>Your courses:</h4><br>
<div class="fallinfo">
<a href="#" class="fallinfo" data-id="<%= @user.role.id %>">Fall 2018 </a>
</div>
<br>
<div class="winterinfo">
<a href="#" class="winterinfo" data-id="<%= @user.role.id %>">Winter 2019 </a>
</div>

<script>
  $(function addEventListenerToStudentPage() {
    $('a.fallinfo').on('click', function (e) {
      e.preventDefault()
      let id = e.target.dataset.id
      let emptyArray = []
      $.get('students/' + id + '/fallcourses', function (data) {

          let enrollmentArray = data
        function dataCollector(enrollmentArray) {
          for (var i = 0; i < enrollmentArray.length; i++) {
            let courseName = enrollmentArray[i]["course"]["name"]
            let grade = enrollmentArray[i]["grade"]["letter"]
            let enrolledOnRaw = enrollmentArray[i]["created_at"].split("T")[0]
            // var enrolledOn = enrolledOnRaw.split("T")[1]
            emptyArray.push('<tr><th scope="row">' + courseName + '</th><td>' + grade + '</td><td>' + enrolledOnRaw + '</td></tr>')
          }
          return emptyArray.join("")
        }
        $('div.fallinfo').append('<table class="table table-striped"<thead><tr><th scope="col">Course Name</th><th scope="col">Grade</th><th scope="col">Enrolled On</th></tr></thead><tbody>' + dataCollector(enrollmentArray) + '</tbody></table>')
      })

    })
  })
  // $(function enroll(enrolledOnRaw) {
  //   return enrolledOnRaw.split("T")[1]
  // })
</script>
<br>
<br>

<p><u>Fall 2018</u></p>
<table class="table table-striped">
  <thead>
    <tr>
      <th scope="col">Course Name</th>
      <th scope="col">Grade</th>
      <th scope="col">Enrolled On</th>
    </tr>
  </thead>
  <tbody>
    <tr>
<% @user.role.enrollments.for_semester("Fall 2018").each do |enrollment| %>
<th scope="row"><%=enrollment.course_name %></th>
<td><%= enrollment.grade_letter %></td>
<td><%= enrollment.enrollment_date %></td>
</tr>
<% end %>
  </tbody>
</table>

<p><u>Winter 2019</u></p>
<table class="table table-striped">
  <thead>
    <tr>
      <th scope="col">Course Name</th>
      <th scope="col">Grade</th>
      <th scope="col">Enrollment On</th>
    </tr>
  </thead>
  <tbody>
    <tr>
<% @user.role.winter_2019.each do |course| %>
<th scope="row"><%=course.name %></th>
  <td><%= course.course_grade(@user.role).letter%></td>
  <td><%= @user.role.enrollments.find_by(course: course).enrollment_date %></td>
</tr>
<% end %>
 </tbody>
</table>
<br>
<%= link_to "View Course Catalogue", profiles_courses_path %>
<br>
<%= link_to "Log Out", session_path(@user), method: "delete" %>
